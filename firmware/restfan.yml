---
substitutions:
  oscillation_pin: GPIO2

esphome:
  name: restfan
  platform: ESP8266
  board: d1_mini
  includes:
    - restfan.h

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

api:

logger:

ota:

output:
  - platform: custom
    type: float
    outputs:
      id: fanspeed_output
    lambda: |-
      auto rest_fan = new RestFanOutput();
      App.register_component(rest_fan);
      return {rest_fan};

  - platform: gpio
    pin: $oscillation_pin
    id: oscillation_output

    
      #switch:
      #  - platform: template    
      #    id: update_fan_speed
      #    optimistic: True
      #    turn_on_action:
      #      then:
      #        - delay: 200ms
      #        - if:
      #            condition:
      #              and:
      #                - switch.is_off: fan_relay1
      #                - switch.is_off: fan_relay2
      #                - switch.is_off: fan_relay3
      #            then:
      #              - fan.turn_off: ifan02_fan
      #        - if:
      #            condition:
      #              and:
      #                - switch.is_on: fan_relay1
      #                - switch.is_off: fan_relay2
      #                - switch.is_off: fan_relay3
      #            then:
      #              - fan.turn_on:
      #                  id: ifan02_fan
      #                  speed: LOW
      #        - if:
      #            condition:
      #              and:
      #                - switch.is_on: fan_relay1
      #                - switch.is_on: fan_relay2
      #                - switch.is_off: fan_relay3
      #            then:
      #              - fan.turn_on:
      #                  id: ifan02_fan
      #                  speed: MEDIUM
      #        - if:
      #            condition:
      #              and:
      #                - switch.is_on: fan_relay1
      #                - switch.is_off: fan_relay2
      #                - switch.is_on: fan_relay3
      #            then:
      #              - fan.turn_on:
      #                  id: ifan02_fan
      #                  speed: HIGH
      #        - switch.turn_off: update_fan_speed
      #
      #  - platform: gpio
      #    pin: GPIO5
      #    id: fan_relay1
      #
      #  - platform: gpio
      #    pin: GPIO4
      #    id: fan_relay2
      #
      #  - platform: gpio
      #    pin: GPIO15
      #    id: fan_relay3


fan:
  - platform: speed
    output: fanspeed_output
    oscillation_output: oscillation_output 
    id: restfan
    name: "RESTfan"
